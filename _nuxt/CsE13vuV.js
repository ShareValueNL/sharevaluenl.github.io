import{d as P,r as m,a as F,l as N,S as E,T as $,H as b,f as n,o as u,u as t,g as i,p as h,C as k,_ as D,t as w,e as B}from"./CJuxFLxH.js";import{_ as H,u as I}from"./2BVULBZp.js";import{u as M}from"./DrfMXeAi.js";import{u as O}from"./CglGgEUd.js";import"./DP1xRhsh.js";import"./DwIt28Sz.js";import"./DVJj6ELX.js";import"./DfipF_8L.js";import"./BDCWtoiU.js";import"./CO2dy0gC.js";import"./tMm0wm5T.js";import"./B1aVLe4D.js";const R={key:0,class:"flex justify-center items-center min-h-screen"},V={class:"flex flex-col items-center"},q={key:0,class:"mt-4 text-sm text-gray-500"},z={key:1},S={key:0,class:"container py-8"},A=["innerHTML"],G={key:1,class:"mt-4"},J={key:"retry",class:"flex flex-col justify-center items-center min-h-screen"},K={key:0,class:"text-center mb-4 text-gray-500 max-w-lg mx-auto text-sm"},Q={key:"error",class:"flex flex-col justify-center items-center min-h-screen"},U={key:"generic-loading",class:"flex flex-col justify-center items-center min-h-screen"},W={class:"text-center text-xs text-gray-500 mb-3"},X={key:5},T=3,me=P({__name:"[slug]",async setup(Y){const r=m(null),y=m([]),a=m(!0),f=F(),d=m(null),o=m(0),g=m(!1),v=m(!1),s=m(!1);N(()=>({hasData:!!r.value,isLoading:a.value,isFetching:v.value,hasError:!!d.value,retryCount:o.value,hasCompletedInitialLoad:s.value,slug:f.params.slug}));const p=async()=>{if(v.value)return console.log("Already fetching data, skipping duplicate request"),!1;if(!f.params.slug)return console.error("Missing slug parameter, cannot load data"),!1;v.value=!0;const l=!r.value;a.value=l,d.value=null;try{let c,x=!1;const C=setTimeout(()=>{x=!0,console.error(`Timeout of 15000ms exceeded when fetching data for ${f.params.slug}`)},15e3);try{const L=B("aanpakken",{filters:{slug:{$eq:f.params.slug}}});return c=await Promise.race([L,new Promise((_,j)=>{setTimeout(()=>{x&&j(new Error("Fetch timeout after 15000ms"))},15100)})]),clearTimeout(C),M(c,{waitForData:!0,showErrorPage:!1}),c&&c.length?(r.value=c[0],r.value?.blocks&&(y.value=r.value.blocks.map(_=>({..._,componentName:I(_.__component)}))),o.value=0,s.value=!0,!0):(s.value=!0,!1)}finally{clearTimeout(C)}}catch(e){if(console.error(`Error fetching aanpak data (attempt ${o.value+1}):`,e),d.value=e,o.value<T){o.value++;{const c=o.value*700;setTimeout(p,c)}return}return s.value=!0,!1}finally{v.value=!1,a.value=!1}};return a.value=!0,s.value=!1,E(()=>{p().catch(l=>{console.error("[CLIENT] Error during initial data loading:",l),s.value=!0,a.value=!1})}),$(()=>{s.value=!1,a.value=!0,E(()=>{r.value?(s.value=!0,a.value=!1):(o.value=0,p().catch(()=>{s.value=!0,a.value=!1})),setTimeout(()=>{!r.value&&!v.value&&(o.value=0,a.value=!0,p().finally(()=>{s.value=!0,a.value=!1}))},700)})}),b(()=>f.params.slug,(l,e)=>{l&&l!==e&&(r.value=null,y.value=[],o.value=0,s.value=!1,a.value=!0,g.value=!1,setTimeout(()=>{p().catch(()=>{s.value=!0,a.value=!1})},50))}),b(()=>r.value?.seo,l=>{l&&O(l)},{immediate:!0}),b(a,l=>{l&&(g.value=!1,setTimeout(()=>{a.value&&(g.value=!0,setTimeout(()=>{a.value&&!v.value&&(a.value=!1,s.value=!0,console.warn("Loading state was forcefully reset after timeout"))},6e3))},4e3))}),(l,e)=>{const c=D,x=H;return u(),n("div",null,[t(a)&&(!t(g)||!t(s))?(u(),n("div",R,[i("div",V,[h(c),t(g)?(u(),n("p",q," Dit duurt langer dan verwacht... ")):k("",!0)])])):t(r)?(u(),n("div",z,[h(x,{"page-blocks":t(y),"is-loading":!1},null,8,["page-blocks"]),t(y).length?k("",!0):(u(),n("div",S,[i("h1",null,w(t(r).title),1),t(r).content?(u(),n("div",{key:0,class:"mt-4",innerHTML:t(r).content},null,8,A)):(u(),n("div",G,[...e[2]||(e[2]=[i("p",null,"Geen inhoud beschikbaar voor deze pagina.",-1)])]))]))])):t(d)&&t(o)<T?(u(),n("div",J,[e[4]||(e[4]=i("p",{class:"text-center mb-4 text-gray-600"},"Er is een probleem opgetreden bij het laden van de pagina.",-1)),t(d)?(u(),n("div",K,[i("p",null,"Foutmelding: "+w(t(d).message||"Onbekende fout"),1),e[3]||(e[3]=i("p",{class:"mt-2"},"Het kan zijn dat er een netwerkprobleem is of dat de server tijdelijk niet beschikbaar is.",-1))])):k("",!0),i("button",{onClick:e[0]||(e[0]=()=>{t(o).value=0,p()}),class:"px-4 py-2 bg-brand-primary text-white rounded hover:bg-brand-primary-dark transition-colors"}," Opnieuw proberen ")])):t(d)&&t(o)>=T?(u(),n("div",Q,[e[5]||(e[5]=i("p",{class:"text-center mb-4 text-red-600"},"Er is een probleem opgetreden bij het verbinden met de server.",-1)),e[6]||(e[6]=i("p",{class:"text-center mb-4 text-gray-600"},"Probeer het later opnieuw of neem contact op met de beheerder.",-1)),i("button",{onClick:e[1]||(e[1]=()=>{t(o).value=0,p()}),class:"px-4 py-2 bg-brand-primary text-white rounded hover:bg-brand-primary-dark transition-colors"}," Opnieuw proberen ")])):!t(s)||t(v)?(u(),n("div",U,[e[7]||(e[7]=i("p",{class:"text-center mb-4 text-gray-600"},"Pagina wordt geladen...",-1)),i("p",W,w(t(f).params.slug),1),h(c)])):(u(),n("div",X,[h(c)]))])}}});export{me as default};
