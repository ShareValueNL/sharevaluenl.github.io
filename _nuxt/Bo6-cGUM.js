import{u as $,_ as F,a as N}from"./Cr9Wl7pL.js";import{d as D,r as m,a as O,k as B,O as L,P as I,E as k,e as n,u as t,f as i,n as h,A as _,t as w,o as u}from"./DfbAEhwh.js";import{u as M}from"./Ci1TRiRn.js";import{u as H}from"./--NelaNo.js";import{u as R}from"./CIzclGfC.js";import"./Ce5E2i10.js";import"./CeTfgpec.js";import"./C0ej8V-z.js";import"./CTpun-6L.js";import"./g3Vw0fS1.js";import"./_do4a06x.js";import"./DFf0lFbW.js";import"./DBOboC8S.js";import"./b8lFzd2I.js";const V={key:0,class:"flex justify-center items-center min-h-screen"},q={class:"flex flex-col items-center"},z={key:0,class:"mt-4 text-sm text-gray-500"},A={key:1},G={key:0,class:"container py-8"},S=["innerHTML"],J={key:1,class:"mt-4"},K={key:"retry",class:"flex flex-col justify-center items-center min-h-screen"},Q={key:0,class:"text-center mb-4 text-gray-500 max-w-lg mx-auto text-sm"},U={key:"error",class:"flex flex-col justify-center items-center min-h-screen"},W={key:"generic-loading",class:"flex flex-col justify-center items-center min-h-screen"},X={class:"text-center text-xs text-gray-500 mb-3"},Y={key:5},T=3,fe=D({__name:"[slug]",async setup(Z){const o=m(null),x=m([]),a=m(!0),g=O(),d=m(null),l=m(0),y=m(!1),v=m(!1),s=m(!1);B(()=>({hasData:!!o.value,isLoading:a.value,isFetching:v.value,hasError:!!d.value,retryCount:l.value,hasCompletedInitialLoad:s.value,slug:g.params.slug}));const f=async()=>{var e;if(v.value)return console.log("Already fetching data, skipping duplicate request"),!1;if(!g.params.slug)return console.error("Missing slug parameter, cannot load data"),!1;v.value=!0;const r=!o.value;a.value=r,d.value=null;try{let c,E=!1;const C=setTimeout(()=>{E=!0,console.error(`Timeout of 15000ms exceeded when fetching data for ${g.params.slug}`)},15e3);try{const P=M("aanpakken",{filters:{slug:{$eq:g.params.slug}}});return c=await Promise.race([P,new Promise((b,j)=>{setTimeout(()=>{E&&j(new Error("Fetch timeout after 15000ms"))},15100)})]),clearTimeout(C),H(c,{waitForData:!0,showErrorPage:!1}),c&&c.length?(o.value=c[0],(e=o.value)!=null&&e.blocks&&(x.value=o.value.blocks.map(b=>({...b,componentName:$(b.__component)}))),l.value=0,s.value=!0,!0):(s.value=!0,!1)}finally{clearTimeout(C)}}catch(p){if(console.error(`Error fetching aanpak data (attempt ${l.value+1}):`,p),d.value=p,l.value<T){l.value++;{const c=l.value*700;setTimeout(f,c)}return}return s.value=!0,!1}finally{v.value=!1,a.value=!1}};return a.value=!0,s.value=!1,L(()=>{f().catch(r=>{console.error("[CLIENT] Error during initial data loading:",r),s.value=!0,a.value=!1})}),I(()=>{s.value=!1,a.value=!0,L(()=>{o.value?(s.value=!0,a.value=!1):(l.value=0,f().catch(()=>{s.value=!0,a.value=!1})),setTimeout(()=>{!o.value&&!v.value&&(l.value=0,a.value=!0,f().finally(()=>{s.value=!0,a.value=!1}))},700)})}),k(()=>g.params.slug,(r,e)=>{r&&r!==e&&(o.value=null,x.value=[],l.value=0,s.value=!1,a.value=!0,y.value=!1,setTimeout(()=>{f().catch(()=>{s.value=!0,a.value=!1})},50))}),k(()=>{var r;return(r=o.value)==null?void 0:r.seo},r=>{r&&R(r)},{immediate:!0}),k(a,r=>{r&&(y.value=!1,setTimeout(()=>{a.value&&(y.value=!0,setTimeout(()=>{a.value&&!v.value&&(a.value=!1,s.value=!0,console.warn("Loading state was forcefully reset after timeout"))},6e3))},4e3))}),(r,e)=>{const p=N,c=F;return u(),n("div",null,[t(a)&&(!t(y)||!t(s))?(u(),n("div",V,[i("div",q,[h(p),t(y)?(u(),n("p",z," Dit duurt langer dan verwacht... ")):_("",!0)])])):t(o)?(u(),n("div",A,[h(c,{"page-blocks":t(x),"is-loading":!1},null,8,["page-blocks"]),t(x).length?_("",!0):(u(),n("div",G,[i("h1",null,w(t(o).title),1),t(o).content?(u(),n("div",{key:0,class:"mt-4",innerHTML:t(o).content},null,8,S)):(u(),n("div",J,e[2]||(e[2]=[i("p",null,"Geen inhoud beschikbaar voor deze pagina.",-1)])))]))])):t(d)&&t(l)<T?(u(),n("div",K,[e[4]||(e[4]=i("p",{class:"text-center mb-4 text-gray-600"},"Er is een probleem opgetreden bij het laden van de pagina.",-1)),t(d)?(u(),n("div",Q,[i("p",null,"Foutmelding: "+w(t(d).message||"Onbekende fout"),1),e[3]||(e[3]=i("p",{class:"mt-2"},"Het kan zijn dat er een netwerkprobleem is of dat de server tijdelijk niet beschikbaar is.",-1))])):_("",!0),i("button",{onClick:e[0]||(e[0]=()=>{t(l).value=0,f()}),class:"px-4 py-2 bg-brand-primary text-white rounded hover:bg-brand-primary-dark transition-colors"}," Opnieuw proberen ")])):t(d)&&t(l)>=T?(u(),n("div",U,[e[5]||(e[5]=i("p",{class:"text-center mb-4 text-red-600"},"Er is een probleem opgetreden bij het verbinden met de server.",-1)),e[6]||(e[6]=i("p",{class:"text-center mb-4 text-gray-600"},"Probeer het later opnieuw of neem contact op met de beheerder.",-1)),i("button",{onClick:e[1]||(e[1]=()=>{t(l).value=0,f()}),class:"px-4 py-2 bg-brand-primary text-white rounded hover:bg-brand-primary-dark transition-colors"}," Opnieuw proberen ")])):!t(s)||t(v)?(u(),n("div",W,[e[7]||(e[7]=i("p",{class:"text-center mb-4 text-gray-600"},"Pagina wordt geladen...",-1)),i("p",X,w(t(g).params.slug),1),h(p)])):(u(),n("div",Y,[h(p)]))])}}});export{fe as default};
